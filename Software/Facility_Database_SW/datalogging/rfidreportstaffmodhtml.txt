<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>List of Staff or MOD Eligible</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="style.css" rel="stylesheet">
  <script src="commonfunctions.js"></script>
  
  <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 400px;
      border-radius: 5px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: black;
    }
    .edit-btn {
      background-color: #4CAF50;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    .edit-btn:hover {
      background-color: #45a049;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .checkbox-group {
      margin-left: 10px;
    }
    .checkbox-group label {
      display: inline;
      font-weight: normal;
      margin-left: 5px;
    }
    .save-btn {
      background-color: #008CBA;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .save-btn:hover {
      background-color: #007399;
    }
    .cancel-btn {
      background-color: #f44336;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      margin-left: 10px;
    }
    .cancel-btn:hover {
      background-color: #da190b;
    }
    .search-container {
      background-color: #f5f5f5;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    .search-input {
      padding: 8px;
      width: 300px;
      border: 1px solid #ccc;
      border-radius: 3px;
      font-size: 14px;
    }
    .search-btn {
      background-color: #008CBA;
      color: white;
      padding: 8px 20px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
      margin-left: 10px;
    }
    .search-btn:hover {
      background-color: #007399;
    }
    .search-results {
      margin-bottom: 30px;
    }
    .search-results h3 {
      color: #333;
      border-bottom: 2px solid #008CBA;
      padding-bottom: 5px;
    }
  </style>
  
  <script>
    let editModal = null;
    let currentClientID = null;
    let currentRow = null;
    
    function openEditModal(clientID, firstName, lastName, displayClasses, modEligible) {
      currentClientID = clientID;
      currentRow = event.target.closest('tr');
      
      document.getElementById('editClientName').textContent = lastName + ', ' + firstName;
      document.getElementById('modEligible').checked = (modEligible == 1);
      
      // Parse displayClasses and set checkboxes independently
      document.getElementById('staffCheck').checked = displayClasses.includes('staff');
      document.getElementById('exStaffCheck').checked = displayClasses.includes('exStaff');
      
      editModal = document.getElementById('editModal');
      editModal.style.display = 'block';
    }
    
    function closeEditModal() {
      editModal.style.display = 'none';
    }
    
    function saveChanges() {
      const modEligible = document.getElementById('modEligible').checked ? 1 : 0;
      
      // Build displayClasses from checkboxes
      const parts = [];
      if (document.getElementById('staffCheck').checked) {
        parts.push('staff');
      }
      if (document.getElementById('exStaffCheck').checked) {
        parts.push('exStaff');
      }
      const displayClasses = parts.join(' ');
      
      // Send AJAX request
      const xhr = new XMLHttpRequest();
      xhr.open('POST', window.location.pathname, true);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      
      xhr.onload = function() {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          if (response.success) {
            alert('Changes saved successfully!');
            // Refresh the page to show updated data
            window.location.reload();
          } else {
            alert('Error: ' + response.message);
          }
        } else {
          alert('Error saving changes');
        }
      };
      
      xhr.send('action=update&clientID=' + encodeURIComponent(currentClientID) + 
               '&modEligible=' + encodeURIComponent(modEligible) + 
               '&displayClasses=' + encodeURIComponent(displayClasses));
      
      closeEditModal();
    }
    
    window.onclick = function(event) {
      if (event.target == editModal) {
        closeEditModal();
      }
    }
  </script>
</head>

<body>
	<<AUTH_HEADER>>
	<h1>Staff or MOD Eligible</h1>
	
	<!-- Search Form -->
	<div class="search-container">
	    <form method="GET" action="">
	        <label for="searchName"><strong>Search for Person:</strong></label>
	        <input type="text" id="searchName" name="search" class="search-input" placeholder="Enter first or last name" value="<<SEARCHVALUE>>">
	        <button type="submit" class="search-btn">Search</button>
	        <<CLEARSEARCH>>
	    </form>
	</div>
	
	<<SEARCHRESULTS>>
	
	<div style="clear:both">
  	    <<RESULTTABLE>>
    </div>
    
    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h2>Edit Member</h2>
        <p><strong id="editClientName"></strong></p>
        
        <div class="form-group">
          <label>Display Classes:</label>
          <div class="checkbox-group">
            <input type="checkbox" id="staffCheck" name="staff" value="Staff">
            <label for="staffCheck">Staff</label>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="exStaffCheck" name="exStaff" value="exStaff">
            <label for="exStaffCheck">Ex Staff</label>
          </div>
        </div>
        
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="modEligible" name="modEligible">
            <label for="modEligible">MOD Eligible</label>
          </div>
        </div>
        
        <button class="save-btn" onclick="saveChanges()">Save</button>
        <button class="cancel-btn" onclick="closeEditModal()">Cancel</button>
      </div>
    </div>
</body>

</html>